{"version":3,"names":["useCallback","useRef","useEvent","useHandler","useSharedValue","useAnimatedKeyboardHandler","handlers","dependencies","context","doDependenciesDiffer","event","onKeyboardMoveStart","onKeyboardMove","onKeyboardMoveEnd","eventName","endsWith","useSharedHandlers","jsHandlers","updateSharedHandlers","value","current","setHandlers","handler","broadcast","type","Object","keys","forEach","key"],"sources":["internal.ts"],"sourcesContent":["import { useCallback, useRef } from 'react';\nimport { useEvent, useHandler, useSharedValue } from 'react-native-reanimated';\n\nimport type { EventWithName, Handlers, NativeEvent } from './types';\n\nexport function useAnimatedKeyboardHandler<\n  TContext extends Record<string, unknown>\n>(\n  handlers: {\n    onKeyboardMoveStart?: (e: NativeEvent, context: TContext) => void;\n    onKeyboardMove?: (e: NativeEvent, context: TContext) => void;\n    onKeyboardMoveEnd?: (e: NativeEvent, context: TContext) => void;\n  },\n  dependencies?: ReadonlyArray<unknown>\n) {\n  const { context, doDependenciesDiffer } = useHandler(handlers, dependencies);\n\n  return useEvent(\n    (event: EventWithName<NativeEvent>) => {\n      'worklet';\n      const { onKeyboardMoveStart, onKeyboardMove, onKeyboardMoveEnd } =\n        handlers;\n\n      if (\n        onKeyboardMoveStart &&\n        event.eventName.endsWith('onKeyboardMoveStart')\n      ) {\n        onKeyboardMoveStart(event, context);\n      }\n\n      if (onKeyboardMove && event.eventName.endsWith('onKeyboardMove')) {\n        onKeyboardMove(event, context);\n      }\n\n      if (onKeyboardMoveEnd && event.eventName.endsWith('onKeyboardMoveEnd')) {\n        onKeyboardMoveEnd(event, context);\n      }\n    },\n    ['onKeyboardMoveStart', 'onKeyboardMove', 'onKeyboardMoveEnd'],\n    doDependenciesDiffer\n  );\n}\n\n/**\n * Hook for storing worklet handlers (objects with keys, where values are worklets).\n * Returns methods for setting handlers and broadcasting events in them.\n *\n * T is a generic that looks like:\n * @example\n * {\n *  onEvent: () => {},\n *  onEvent2: () => {},\n * }\n */\nexport function useSharedHandlers<T extends Record<string, Function>>() {\n  const handlers = useSharedValue<Handlers<T>>({});\n  const jsHandlers = useRef<Handlers<T>>({});\n\n  // since js -> worklet -> js call is asynchronous, we can not write handlers\n  // straight into shared variable (using current shared value as a previous result),\n  // since there may be a race condition in a call, and closure may have out-of-dated\n  // values. As a result, some of handlers may be not written to \"all handlers\" object.\n  // Below we are writing all handlers to `ref` and afterwards synchronize them with\n  // shared value (since `refs` are not referring to actual value in worklets).\n  // This approach allow us to update synchronously handlers in js thread (and it assures,\n  // that it will have all of them) and then update them in worklet thread (calls are\n  // happening in FIFO order, so we will always have actual value).\n  const updateSharedHandlers = () => {\n    handlers.value = jsHandlers.current;\n  };\n  const setHandlers = useCallback((handler: Handlers<T>) => {\n    jsHandlers.current = {\n      ...jsHandlers.current,\n      ...handler,\n    };\n    updateSharedHandlers();\n  }, []);\n  const broadcast = (type: keyof T, event: NativeEvent) => {\n    'worklet';\n\n    Object.keys(handlers.value).forEach((key) =>\n      handlers.value[key]?.[type]?.(event)\n    );\n  };\n\n  return { setHandlers, broadcast };\n}\n"],"mappings":"AAAA,SAASA,WAAT,EAAsBC,MAAtB,QAAoC,OAApC;AACA,SAASC,QAAT,EAAmBC,UAAnB,EAA+BC,cAA/B,QAAqD,yBAArD;AAIA,OAAO,SAASC,0BAAT,CAGLC,QAHK,EAQLC,YARK,EASL;EACA,MAAM;IAAEC,OAAF;IAAWC;EAAX,IAAoCN,UAAU,CAACG,QAAD,EAAWC,YAAX,CAApD;EAEA,OAAOL,QAAQ,CACZQ,KAAD,IAAuC;IACrC;;IACA,MAAM;MAAEC,mBAAF;MAAuBC,cAAvB;MAAuCC;IAAvC,IACJP,QADF;;IAGA,IACEK,mBAAmB,IACnBD,KAAK,CAACI,SAAN,CAAgBC,QAAhB,CAAyB,qBAAzB,CAFF,EAGE;MACAJ,mBAAmB,CAACD,KAAD,EAAQF,OAAR,CAAnB;IACD;;IAED,IAAII,cAAc,IAAIF,KAAK,CAACI,SAAN,CAAgBC,QAAhB,CAAyB,gBAAzB,CAAtB,EAAkE;MAChEH,cAAc,CAACF,KAAD,EAAQF,OAAR,CAAd;IACD;;IAED,IAAIK,iBAAiB,IAAIH,KAAK,CAACI,SAAN,CAAgBC,QAAhB,CAAyB,mBAAzB,CAAzB,EAAwE;MACtEF,iBAAiB,CAACH,KAAD,EAAQF,OAAR,CAAjB;IACD;EACF,CApBY,EAqBb,CAAC,qBAAD,EAAwB,gBAAxB,EAA0C,mBAA1C,CArBa,EAsBbC,oBAtBa,CAAf;AAwBD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASO,iBAAT,GAAiE;EACtE,MAAMV,QAAQ,GAAGF,cAAc,CAAc,EAAd,CAA/B;EACA,MAAMa,UAAU,GAAGhB,MAAM,CAAc,EAAd,CAAzB,CAFsE,CAItE;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EACA,MAAMiB,oBAAoB,GAAG,MAAM;IACjCZ,QAAQ,CAACa,KAAT,GAAiBF,UAAU,CAACG,OAA5B;EACD,CAFD;;EAGA,MAAMC,WAAW,GAAGrB,WAAW,CAAEsB,OAAD,IAA0B;IACxDL,UAAU,CAACG,OAAX,GAAqB,EACnB,GAAGH,UAAU,CAACG,OADK;MAEnB,GAAGE;IAFgB,CAArB;IAIAJ,oBAAoB;EACrB,CAN8B,EAM5B,EAN4B,CAA/B;;EAOA,MAAMK,SAAS,GAAG,CAACC,IAAD,EAAgBd,KAAhB,KAAuC;IACvD;;IAEAe,MAAM,CAACC,IAAP,CAAYpB,QAAQ,CAACa,KAArB,EAA4BQ,OAA5B,CAAqCC,GAAD;MAAA;;MAAA,8BAClCtB,QAAQ,CAACa,KAAT,CAAeS,GAAf,CADkC,iFAClC,oBAAsBJ,IAAtB,CADkC,0DAClC,gDAA8Bd,KAA9B,CADkC;IAAA,CAApC;EAGD,CAND;;EAQA,OAAO;IAAEW,WAAF;IAAeE;EAAf,CAAP;AACD"}