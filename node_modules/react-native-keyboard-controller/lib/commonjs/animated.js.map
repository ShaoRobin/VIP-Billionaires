{"version":3,"names":["KeyboardControllerViewAnimated","Reanimated","createAnimatedComponent","Animated","KeyboardControllerView","styles","StyleSheet","create","container","flex","hidden","display","position","KeyboardProvider","children","statusBarTranslucent","progress","useRef","Value","current","height","progressSV","useSharedValue","heightSV","setHandlers","broadcast","useSharedHandlers","context","useMemo","animated","multiply","reanimated","style","transform","translateX","translateY","onKeyboardMove","event","nativeEvent","useNativeDriver","updateSharedValues","platforms","includes","Platform","OS","value","handler","useAnimatedKeyboardHandler","onKeyboardMoveStart","onKeyboardMoveEnd","undefined"],"sources":["animated.tsx"],"sourcesContent":["import React, { useMemo, useRef } from 'react';\nimport { Animated, Platform, StyleSheet, ViewStyle } from 'react-native';\nimport Reanimated, { useSharedValue } from 'react-native-reanimated';\n\nimport { KeyboardContext } from './context';\nimport { useAnimatedKeyboardHandler, useSharedHandlers } from './internal';\nimport { KeyboardControllerView } from './native';\n\nimport type {\n  KeyboardControllerProps,\n  KeyboardHandler,\n  NativeEvent,\n} from './types';\n\nconst KeyboardControllerViewAnimated = Reanimated.createAnimatedComponent(\n  Animated.createAnimatedComponent(\n    KeyboardControllerView\n  ) as React.FC<KeyboardControllerProps>\n);\n\ntype Styles = {\n  container: ViewStyle;\n  hidden: ViewStyle;\n};\n\nexport const styles = StyleSheet.create<Styles>({\n  container: {\n    flex: 1,\n  },\n  hidden: {\n    display: 'none',\n    position: 'absolute',\n  },\n});\n\ntype KeyboardProviderProps = {\n  children: React.ReactNode;\n  /**\n   * Set the value to `true`, if you use translucent status bar on Android.\n   * If you already control status bar translucency via `react-native-screens`\n   * or `StatusBar` component from `react-native`, you can ignore it.\n   * Defaults to `false`.\n   *\n   * @see https://github.com/kirillzyusko/react-native-keyboard-controller/issues/14\n   * @platform android\n   */\n  statusBarTranslucent?: boolean;\n};\n\nexport const KeyboardProvider = ({\n  children,\n  statusBarTranslucent,\n}: KeyboardProviderProps) => {\n  // animated values\n  const progress = useRef(new Animated.Value(0)).current;\n  const height = useRef(new Animated.Value(0)).current;\n  // shared values\n  const progressSV = useSharedValue(0);\n  const heightSV = useSharedValue(0);\n  const { setHandlers, broadcast } = useSharedHandlers<KeyboardHandler>();\n  // memo\n  const context = useMemo(\n    () => ({\n      animated: { progress: progress, height: Animated.multiply(height, -1) },\n      reanimated: { progress: progressSV, height: heightSV },\n      setHandlers,\n    }),\n    []\n  );\n  const style = useMemo(\n    () => [\n      styles.hidden,\n      { transform: [{ translateX: height }, { translateY: progress }] },\n    ],\n    []\n  );\n  const onKeyboardMove = useMemo(\n    () =>\n      Animated.event(\n        [\n          {\n            nativeEvent: {\n              progress,\n              height,\n            },\n          },\n        ],\n        { useNativeDriver: true }\n      ),\n    []\n  );\n  // handlers\n  const updateSharedValues = (event: NativeEvent, platforms: string[]) => {\n    'worklet';\n\n    if (platforms.includes(Platform.OS)) {\n      progressSV.value = event.progress;\n      heightSV.value = -event.height;\n    }\n  };\n  const handler = useAnimatedKeyboardHandler(\n    {\n      onKeyboardMoveStart: (event: NativeEvent) => {\n        'worklet';\n\n        broadcast('onStart', event);\n        updateSharedValues(event, ['ios']);\n      },\n      onKeyboardMove: (event: NativeEvent) => {\n        'worklet';\n\n        broadcast('onMove', event);\n        updateSharedValues(event, ['android']);\n      },\n      onKeyboardMoveEnd: (event: NativeEvent) => {\n        'worklet';\n\n        broadcast('onEnd', event);\n      },\n    },\n    []\n  );\n\n  return (\n    <KeyboardContext.Provider value={context}>\n      <KeyboardControllerViewAnimated\n        onKeyboardMoveReanimated={handler}\n        onKeyboardMoveStart={Platform.OS === 'ios' ? onKeyboardMove : undefined}\n        onKeyboardMove={Platform.OS === 'android' ? onKeyboardMove : undefined}\n        statusBarTranslucent={statusBarTranslucent}\n        style={styles.container}\n      >\n        <>\n          <Animated.View\n            // we are using this small hack, because if the component (where\n            // animated value has been used) is unmounted, then animation will\n            // stop receiving events (seems like it's react-native optimization).\n            // So we need to keep a reference to the animated value, to keep it's\n            // always mounted (keep a reference to an animated value).\n            //\n            // To test why it's needed, try to open screen which consumes Animated.Value\n            // then close it and open it again (for example 'Animated transition').\n            style={style}\n          />\n          {children}\n        </>\n      </KeyboardControllerViewAnimated>\n    </KeyboardContext.Provider>\n  );\n};\n"],"mappings":"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"}